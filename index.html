<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Thermen-Planer</title>
  <link rel="stylesheet" href="styles.css" />
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f0f4f8;
      color: #333;
      margin: 0;
      padding: 2rem;
    }
    h1 {
      text-align: center;
      margin-bottom: 1rem;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      border-radius: 8px;
      padding: 2rem;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    select, button {
      padding: 0.5rem;
      margin: 0.5rem 0.25rem;
      font-size: 1rem;
    }
    #calendar {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 0.5rem;
      margin-top: 1rem;
    }
    .day-box {
      border: 2px solid #ccc;
      border-radius: 6px;
      padding: 0.5rem;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
    }
    .day-box.selected {
      border-color: #007bff;
      background-color: #e0f0ff;
      font-weight: bold;
    }
    .buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-top: 1rem;
    }
    @media (max-width: 600px) {
      #calendar {
        grid-template-columns: repeat(5, 1fr);
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Thermen-Planer</h1>
    <label for="participantSelect">Teilnehmer:</label>
    <select id="participantSelect"></select>

    <div class="buttons">
      <button id="addBtn">Hinzufügen</button>
      <button id="renameBtn">Umbenennen</button>
      <button id="deleteBtn">Löschen</button>
      <button id="saveBtn">Auswahl speichern</button>
    </div>

    <div id="calendar"></div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import { getDatabase, ref, onValue, set } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "DEIN_API_KEY",
      authDomain: "thermen-planer.firebaseapp.com",
      databaseURL: "https://thermen-planer-default-rtdb.firebaseio.com/",
      projectId: "thermen-planer",
      storageBucket: "thermen-planer.appspot.com",
      messagingSenderId: "DEINE_SENDER_ID",
      appId: "DEINE_APP_ID"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const participantSelect = document.getElementById("participantSelect");
    const calendar = document.getElementById("calendar");
    let selectedDays = [];
    let currentUser = "";

    function renderCalendar() {
      const start = new Date();
      calendar.innerHTML = "";
      for (let i = 0; i < 20; i++) {
        const date = new Date();
        date.setDate(start.getDate() + i);
        const dayName = date.toLocaleDateString("de-DE", { weekday: "short" });
        const dayDate = date.toLocaleDateString("de-DE", { day: "2-digit", month: "2-digit" });

        const div = document.createElement("div");
        div.className = "day-box";
        div.dataset.date = dayDate;
        div.innerHTML = `<div>${dayName}</div><div>${dayDate}</div>`;
        div.addEventListener("click", () => {
          div.classList.toggle("selected");
          const idx = selectedDays.indexOf(dayDate);
          if (idx > -1) selectedDays.splice(idx, 1);
          else selectedDays.push(dayDate);
        });
        calendar.appendChild(div);
      }
    }

    function loadParticipants() {
      onValue(ref(db, "participants"), (snapshot) => {
        const data = snapshot.val() || {};
        participantSelect.innerHTML = "";
        Object.keys(data).forEach(name => {
          const opt = document.createElement("option");
          opt.value = name;
          opt.textContent = name;
          participantSelect.appendChild(opt);
        });
        currentUser = participantSelect.value;
        loadSelections();
      });
    }

    function loadSelections() {
      const user = participantSelect.value;
      currentUser = user;
      selectedDays = [];
      onValue(ref(db, `participants/${user}`), (snapshot) => {
        const days = snapshot.val() || [];
        selectedDays = days;
        document.querySelectorAll(".day-box").forEach(box => {
          box.classList.toggle("selected", selectedDays.includes(box.dataset.date));
        });
      });
    }

    document.getElementById("addBtn").addEventListener("click", () => {
      const name = prompt("Neuer Teilnehmername:");
      if (name) set(ref(db, `participants/${name}`), []);
    });

    document.getElementById("renameBtn").addEventListener("click", () => {
      const oldName = participantSelect.value;
      const newName = prompt("Neuer Name:", oldName);
      if (newName && newName !== oldName) {
        onValue(ref(db, `participants/${oldName}`), (snapshot) => {
          const data = snapshot.val();
          set(ref(db, `participants/${newName}`), data);
          set(ref(db, `participants/${oldName}`), null);
        }, { onlyOnce: true });
      }
    });

    document.getElementById("deleteBtn").addEventListener("click", () => {
      const name = participantSelect.value;
      if (confirm(`Teilnehmer '${name}' löschen?`)) {
        set(ref(db, `participants/${name}`), null);
      }
    });

    document.getElementById("saveBtn").addEventListener("click", () => {
      if (currentUser) {
        set(ref(db, `participants/${currentUser}`), selectedDays);
      }
    });

    participantSelect.addEventListener("change", () => {
      loadSelections();
    });

    renderCalendar();
    loadParticipants();
  </script>
</body>
</html>
