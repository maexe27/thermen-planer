<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Thermen-Planer</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background-color: #f5f5f5;
      margin: 0;
      padding: 20px;
    }
    h1 {
      text-align: center;
      margin-bottom: 20px;
    }
    .controls {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      margin-bottom: 20px;
    }
    .controls select,
    .controls button {
      padding: 10px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 8px;
    }
    .calendar {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 10px;
      max-width: 800px;
      margin: 0 auto;
    }
    .day {
      background-color: #fff;
      border: 2px solid #ccc;
      border-radius: 10px;
      text-align: center;
      padding: 10px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .day:hover {
      background-color: #e6f7ff;
    }
    .selected {
      border-color: #007bff;
      background-color: #cce5ff;
    }
    .date-label {
      font-weight: 600;
    }
    @media (max-width: 600px) {
      .calendar {
        grid-template-columns: repeat(5, 1fr); /* Mobil: trotzdem 5 Spalten */
      }
    }
  </style>
</head>
<body>
  <h1>Thermen-Planer</h1>

  <div class="controls">
    <label for="participantSelect">Teilnehmer:</label>
    <select id="participantSelect"></select>

    <button id="addBtn">Teilnehmer hinzufügen</button>
    <button id="renameBtn">Teilnehmer umbenennen</button>
    <button id="deleteBtn">Teilnehmer löschen</button>
    <button id="saveBtn">Auswahl speichern</button>
  </div>

  <div class="calendar" id="calendar"></div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getDatabase, ref, onValue, set } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "DEIN_API_KEY",
  authDomain: "thermen-planer.firebaseapp.com",
  databaseURL: "https://thermen-planer-default-rtdb.firebaseio.com/", // <- wichtig!
  projectId: "thermen-planer",
  storageBucket: "thermen-planer.appspot.com",
  messagingSenderId: "DEINE_SENDER_ID",
  appId: "DEINE_APP_ID"
};

// App initialisieren
const app = initializeApp(firebaseConfig);

// Datenbank korrekt abrufen (ohne URL hier!)
const db = getDatabase(app);


    const calendar = document.getElementById("calendar");
    const participantSelect = document.getElementById("participantSelect");
    const addBtn = document.getElementById("addBtn");
    const renameBtn = document.getElementById("renameBtn");
    const deleteBtn = document.getElementById("deleteBtn");
    const saveBtn = document.getElementById("saveBtn");

    const days = generateNextDays(15);
    let selections = {};

    function generateNextDays(n) {
      const days = [];
      const today = new Date();
      for (let i = 0; i < n; i++) {
        const date = new Date(today);
        date.setDate(today.getDate() + i);
        const dayName = date.toLocaleDateString("de-DE", { weekday: "short" });
        const dayNumber = date.toLocaleDateString("de-DE", { day: "2-digit", month: "2-digit" });
        days.push({ key: date.toISOString().split("T")[0], label: `${dayName}\n${dayNumber}` });
      }
      return days;
    }

    function renderCalendar() {
      calendar.innerHTML = "";
      days.forEach(day => {
        const div = document.createElement("div");
        div.className = "day";
        div.dataset.date = day.key;
        div.innerHTML = `<div class="date-label">${day.label.replace("\n", "<br>")}</div>`;
        if (selections[day.key]) div.classList.add("selected");
        div.onclick = () => {
          selections[day.key] = !selections[day.key];
          renderCalendar();
        };
        calendar.appendChild(div);
      });
    }

    function loadParticipants() {
      const usersRef = ref(db, "users");
      onValue(usersRef, snapshot => {
        participantSelect.innerHTML = "";
        const users = snapshot.val();
        if (!users) return;
        Object.keys(users).forEach(name => {
          const option = document.createElement("option");
          option.value = name;
          option.textContent = name;
          participantSelect.appendChild(option);
        });
        loadSelections();
      });
    }

    function loadSelections() {
      const name = participantSelect.value;
      const selRef = ref(db, `users/${name}`);
      get(selRef).then(snapshot => {
        selections = snapshot.val() || {};
        renderCalendar();
      });
    }

    function saveSelections() {
      const name = participantSelect.value;
      const selRef = ref(db, `users/${name}`);
      set(selRef, selections);
    }

    function addParticipant() {
      const name = prompt("Name des neuen Teilnehmers:");
      if (!name) return;
      const selRef = ref(db, `users/${name}`);
      set(selRef, {});
      participantSelect.value = name;
    }

    function renameParticipant() {
      const oldName = participantSelect.value;
      const newName = prompt("Neuer Name für Teilnehmer:", oldName);
      if (!newName || newName === oldName) return;
      const oldRef = ref(db, `users/${oldName}`);
      const newRef = ref(db, `users/${newName}`);
      get(oldRef).then(snapshot => {
        const data = snapshot.val();
        set(newRef, data);
        remove(oldRef);
        participantSelect.value = newName;
      });
    }

    function deleteParticipant() {
      const name = participantSelect.value;
      if (!confirm(`${name} wirklich löschen?`)) return;
      const userRef = ref(db, `users/${name}`);
      remove(userRef);
      participantSelect.value = "";
    }

    participantSelect.onchange = loadSelections;
    addBtn.onclick = addParticipant;
    renameBtn.onclick = renameParticipant;
    deleteBtn.onclick = deleteParticipant;
    saveBtn.onclick = saveSelections;

    loadParticipants();
  </script>
</body>
</html>
